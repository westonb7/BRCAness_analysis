---
title: "Rtsne_euclidean_rand"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Prep

```{r}
library(readr)
library(Rtsne)
library(dplyr)
library(ggplot2)
library(reshape)
```

## Import the data
## Because this file is needed, it must be generated by "Rtsne_gene_expression.Rmd" first.

```{r}
rtsne_euclid <- as.data.frame((read_tsv("../Data/rtsne_evidence_DF.txt")))
ev_sample_IDs <- rtsne_euclid[,1]
```

## Define function to calculate Euclidean distance

```{r}
euclidean_dist <- function(x1, x2, y1, y2)
{
  return(sqrt((x1-y1)^2 + (x2-y2)^2))
}
```

## Define funciton to calculate distance for a series of points in the DF passed to it
## This function needs to have the functionality to specify which column to parse the category from as well.

```{r}
euclid_calc <- function(calc_DF, cat_1, cat_2, name_1, name_2)
{
  filtered_df1 <- filter(calc_DF, calc_DF[[cat_1]]==name_1)
  filtered_df2 <- filter(calc_DF, calc_DF[[cat_2]]==name_2)
    
  df_1_names <- as.vector(unique(filtered_df1[,1]))
  df_2_names <- as.vector(unique(filtered_df2[,1]))
  dist_DF <- NULL
  
  for (sample_1 in df_1_names)
  {
    for(sample_2 in df_2_names)
    {
      if (sample_1 != sample_2)
      {
        select_1 <- filter(calc_DF, Sample_ID==sample_1 , calc_DF[[cat_1]]==name_1)
        select_2 <- filter(calc_DF, Sample_ID==sample_2 , calc_DF[[cat_2]]==name_2)
        select_2 <- head(select_2,1)
        select_1 <- head(select_1,1)
       
        dist_DF <- rbind(dist_DF, euclidean_dist( as.numeric(select_1["Val_1"]), as.numeric(select_1["Val_2"]), as.numeric(select_2["Val_1"]), as.numeric(select_2["Val_2"]) ) ) 
      }
      #dist_DF <- rbind(dist_DF, euclidean_dist( as.numeric(select_1["Val_1"]), as.numeric(select_1["Val_2"]), as.numeric(select_2["Val_1"]), as.numeric(select_2["Val_2"]) ) ) 
    }
  }
  return(dist_DF)
}
```

## Run the above function on the standard data set to get mean/median for BRCA 1-1, 2-2, 1-2 comparisons. 

```{r}
BRCA_1_1 <- euclid_calc(rtsne_euclid, "BRCA_status", "BRCA_status", "BRCA1", "BRCA1")
BRCA_2_2 <- euclid_calc(rtsne_euclid, "BRCA_status", "BRCA_status", "BRCA2", "BRCA2")
BRCA_1_2 <- euclid_calc(rtsne_euclid, "BRCA_status", "BRCA_status", "BRCA1", "BRCA2")

mean(BRCA_1_1)
median(BRCA_1_1)
mean(BRCA_2_2)
median(BRCA_2_2)
mean(BRCA_1_2)
median(BRCA_1_2)
```

## Create a function to create a "copy" of rtsne_euclid and randomize BRCA1/2 status
## Make sure to use set.seed() before running this function

```{r}
rtsne_randomized <- rtsne_euclid
counter <- (1:nrow(rtsne_euclid))
```

```{r}
randomize_df <- function(rand_df) {
  rand_df$BRCA_status <- sample(rand_df$BRCA_status) 
  return(rand_df)
}
```

## Calculate mean/median euclidean distances for the randomized distribution.

```{r}
r_count <- (1:10)
rtsne_randomized <- rtsne_euclid

stat_BRCA1_1 <- NULL
stat_BRCA2_2 <- NULL
stat_BRCA1_2 <- NULL


distribution_test <- function(iterations, cat_1, cat_2){
  aggregate_stats <- NULL
  r_count <- (1:iterations)
  for (i in r_count)
  {
    rtsne_randomized <- randomize_df(rtsne_randomized)
    calc_1_1 <- euclid_calc(rtsne_randomized, cat_1, cat_2, "BRCA1", "BRCA1")
    calc_2_2 <- euclid_calc(rtsne_randomized, cat_1, cat_2, "BRCA2", "BRCA2")
    calc_1_2 <- euclid_calc(rtsne_randomized, cat_1, cat_2, "BRCA1", "BRCA2")
    stat_1_1 <- c(mean(calc_1_1), median(calc_1_1))
    stat_2_2 <- c(mean(calc_2_2), median(calc_2_2))
    stat_1_2 <- c(mean(calc_1_2), median(calc_1_2))
    stat_BRCA1_1 <<- rbind(stat_BRCA1_1, stat_1_1)
    stat_BRCA2_2 <<- rbind(stat_BRCA2_2, stat_2_2)
    stat_BRCA1_2 <<- rbind(stat_BRCA1_2, stat_1_2)
  }
}

```

## Prototyping the above function

```{r}
rtsne_randomized <- randomize_df(rtsne_randomized)

set.seed(0)

# 10 runs of 50
distribution_test(50,"BRCA_status", "BRCA_status")
distribution_test(50,"BRCA_status", "BRCA_status")
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 

distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 

# Another 10 runs of 50
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 

distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status") 
distribution_test(50,"BRCA_status", "BRCA_status")

colnames(stat_BRCA1_1) <- c("Mean", "Median")
colnames(stat_BRCA2_2) <- c("Mean", "Median")
colnames(stat_BRCA1_2) <- c("Mean", "Median")

```

## Save the randomly generated values to a file (just in case)

```{r}
write.table(stat_BRCA1_1, file="../Data/B_1_1_medians.txt", append= FALSE, quote=FALSE, sep="\t", row.names=FALSE)
write.table(stat_BRCA2_2, file="../Data/B_2_2_medians.txt", append= FALSE, quote=FALSE, sep="\t", row.names=FALSE)
write.table(stat_BRCA1_2, file="../Data/B_1_2_medians.txt", append= FALSE, quote=FALSE, sep="\t", row.names=FALSE)

```

## Reformat matricies into DFs

```{r}
stat_BRCA1_1 <- as.data.frame(stat_BRCA1_1)
stat_BRCA2_2 <- as.data.frame(stat_BRCA2_2)
stat_BRCA1_2 <- as.data.frame(stat_BRCA1_2)
```

## Plot some data (histogram)

```{r}
p <- ggplot(stat_BRCA1_1, aes(x=Median)) + geom_histogram(color="black", fill="white", binwidth=0.2) + labs(title="BRCA 1-1 median distance") + theme(plot.title = element_text(hjust = 0.5, size=16, face="bold"))
p + geom_vline(aes(xintercept=(median(BRCA_1_1))), color = "blue", linetype="dashed", size=1)

ggsave(filename="../Thesis_images/Euc_1_1_median.png", height = 8, width = 9, units = "in")

p <- ggplot(stat_BRCA2_2, aes(x=Median)) + geom_histogram(color="black", fill="white", binwidth=0.2) + labs(title="BRCA 2-2 median distance") + theme(plot.title = element_text(hjust = 0.5, size=16, face="bold"))
p + geom_vline(aes(xintercept=(median(BRCA_2_2))), color = "blue", linetype="dashed", size=1)

ggsave(filename="../Thesis_images/Euc_2_2_median.png", height = 8, width = 9, units = "in")

p <- ggplot(stat_BRCA1_2, aes(x=Median)) + geom_histogram(color="black", fill="white", binwidth=0.2) + labs(title="BRCA 1-2 median distance") + theme(plot.title = element_text(hjust = 0.5, size=16, face="bold"))
p + geom_vline(aes(xintercept=(median(BRCA_1_2))), color = "blue", linetype="dashed", size=1)

ggsave(filename="../Thesis_images/Euc_1_2_median.png", height = 8, width = 9, units = "in")

```

```{r}
p <- ggplot(stat_BRCA1_1, aes(x=Mean)) + geom_histogram(color="black", fill="white", binwidth=0.2) + labs(title="BRCA 1-1 mean distance") + theme(plot.title = element_text(hjust = 0.5, size=16, face="bold"))
p + geom_vline(aes(xintercept=(mean(BRCA_1_1))), color = "blue", linetype="dashed", size=1)

ggsave(filename="../Thesis_images/Euc_1_1_mean.png", height = 8, width = 9, units = "in")

p <- ggplot(stat_BRCA2_2, aes(x=Mean)) + geom_histogram(color="black", fill="white", binwidth=0.2) + labs(title="BRCA 2-2 mean distance") + theme(plot.title = element_text(hjust = 0.5, size=16, face="bold"))
p + geom_vline(aes(xintercept=(mean(BRCA_2_2))), color = "blue", linetype="dashed", size=1)

ggsave(filename="../Thesis_images/Euc_2_2_mean.png", height = 8, width = 9, units = "in")

p <- ggplot(stat_BRCA1_2, aes(x=Mean)) + geom_histogram(color="black", fill="white", binwidth=0.2) + labs(title="BRCA 1-2 mean distance") + theme(plot.title = element_text(hjust = 0.5, size=16, face="bold"))
p + geom_vline(aes(xintercept=(mean(BRCA_1_2))), color = "blue", linetype="dashed", size=1)

ggsave(filename="../Thesis_images/Euc_1_2_mean.png", height = 8, width = 9, units = "in")

```

